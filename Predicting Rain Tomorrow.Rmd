---
title: "Classification Modeling"
author: "Alex Navarro"
date: "10/29/2021"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Load Packages and Data:
```{r setup, include =FALSE}
set.seed(1)
library(ROCR)
library(rpart)
library(rpart.plot)
library(lattice)
library(pROC)
library(naivebayes)
library(nnet)
library(NeuralNetTools)
library(caTools)
# Read data into system:
weather <- read.csv("weather.csv")
# check head 10 of data:
head(weather, n = 10)
# Check for NaN Values:
sum(is.na(weather))
# View Data Structure:
str(weather)
# Convert Rain Tomorrow to Factor:
weather$RainTomorrow <- as.factor(weather$RainTomorrow)
```
```{r, echo=FALSE}
# Split data into training/test set:
train=sample(17378,15000)
test=(c(1:17378)[-train])
weather_train <- weather[train,]
weather_test <- weather[test,]
```
# Modeling:
```{r, setup=FALSE}
# Forward Stepwise Regression:
# Specify a null model with no predictors:
null_model <- glm(RainTomorrow ~ 1, data = weather_train, family = binomial)
# Specify the full model using all of the potential predictors:
full_model <- glm(RainTomorrow ~ ., data = weather_train, family = binomial)
# Perform Forward Stepwise:
step_model <- step(null_model, scope = list(lower = null_model, upper = full_model), direction = "forward")
# Use a forward stepwise algorithm to build a parsimonious model:
```
```{r, setup=FALSE}
# Create Model Using best stepwise output:
step_model2 <- glm(RainTomorrow ~ Sunshine + Pressure3pm + AveHumidity + WindGustSpeed + 
    DifHumidity + Cloud3pm + WindSpeed3pm + Rainfall + WindDir3pm + 
    RainToday + MaxTemp + MinTemp + Temp3pm, family = "binomial",data = weather_train)
summary(step_model2)
```
# Model Diagnostics:
```{r, setup=FALSE}
# Plot the ROC of the stepwise model, tpr,fpr,fnr: and predict:
# Estimate the stepwise donation probability
step_prob <- predict(step_model2,newdata=weather_test,type = "response")
step_prob
```
```{r,setup=FALSE}
set.seed(1)
# Plot the ROC of the stepwise model
pred=ifelse(step_prob>.2,1,0)
table(pred,weather_test$RainTomorrow)
pre=prediction(step_prob,weather_test$RainTomorrow)
perf = performance(pre,"tpr","fpr")
plot(perf,auc.polygon=TRUE, main="ROC plot")
perf=performance(pre,"fpr","cutoff", col = c("blue"))
plot(perf,col = c("blue"))
perf=performance(pre,"fnr","cutoff")
plot(perf, col = c("green"))
prob=predict(step_model2,newdata=weather_train,type="response")
prob=predict(step_model2,newdata=weather,type="response")
pre=prediction(prob,weather$RainTomorrow)
perf=performance(pre,"tpr","rpp")
plot(perf, main="gain curve",print.cutoffs.at=c(.1,.2,.3,.4,.5))
abline(0,1)
# Calculate AUC:
#ROC <- roc(weather$RainTomorrow, prob)
#auc(ROC)
```
```{r, setup=FALSE}
#FPR_Variable <- 397(1420+397)
#FPR
#FNR = 109/(109+452)
#FNR
#Total = 1420+109+397+452
#Overall_Error_Rate = (397+109)/Total
#Overall_Error_Rate
```
# Decision Tree Classifier:
```{r, setup = FALSE}
set.seed(1)
library(rpart)
library(rpart.plot)
train=sample(17378,15000)
test=(c(1:17378)[-train])
weather_train <- weather[train,]
weather_test <- weather[test,]
# convert variables to factor:
weather$WindGustDir <- factor(weather$WindGustDir)
weather$WindDir3pm <- factor(weather$WindDir3pm)
# Create first Model:
m1 <- rpart(RainTomorrow~.,data=weather_train,method="class")
printcp(m1)
plotcp(m1)
rpart.plot(m1,type=3,extra=1)

# Produce the prune tree using the CP value 0.018465:
m2=prune(m1,cp=0.017337)
rpart.plot(m2,type=3,extra=1)
plotcp(m2, col = c("green"))
```
